logseq.ready((function(){console.log("Plugin de limpieza de journals vacíos cargado");var o=function(o,n){if(!o||!o.name)return console.log("Página inválida o sin nombre"),void n(!1);console.log("Verificando si journal está vacío:",o.name),logseq.Editor.getPageBlocksTree(o.name).then((function(e){if(!e||0===e.length)return console.log("No hay bloques en la página:",o.name),void n(!0);for(var a=!0,l=0;l<e.length;l++){var r=e[l].content||"";if(""!==(r=r.trim())&&"- "!==r&&"-"!==r){console.log("Bloque con contenido:",r),a=!1;break}}a?console.log("La página está vacía:",o.name):console.log("La página tiene contenido:",o.name),n(a)})).catch((function(e){console.error("Error al verificar journal:",e,o.name),n(!1)}))},n=function(o){if(!o["journal-day"])return!1;var n=new Date,e=1e4*n.getFullYear()+100*(n.getMonth()+1)+n.getDate();return o["journal-day"]===e},e=function(e){logseq.UI.showMsg("Buscando journals vacíos...","info"),logseq.DB.datascriptQuery("\n      [:find (pull ?p [*])\n       :where\n       [?p :block/journal? true]]\n    ").then((function(a){if(a&&0!==a.length){var l=new Date,r=0,s=0,c=0,i=[],t=0;if(a.forEach((function(o){var e=o[0];e&&e.name?n(e)?(console.log("Saltando journal del día actual:",e.name),t++):(i.push(e),s++):console.log("Ignorando journal inválido o sin nombre")})),console.log("Total de journals válidos encontrados:",s),0===s){var u="No se encontraron journals válidos para procesar";return t>0&&(u+=" (se excluyó el journal del día actual)"),void logseq.UI.showMsg(u,"info")}i.forEach((function(n){try{console.log("Procesando journal:",n.name);var a=null,s=0;if(n["journal-day"]){var i=n["journal-day"],t=Math.floor(i/1e4),u=Math.floor(i%1e4/100)-1;a=new Date(t,u,i%100),console.log("Fecha del journal desde journal-day:",a)}else if(n["created-at"]){var d=n["created-at"];a=new Date(d),console.log("Fecha del journal desde created-at:",a)}if(!a||isNaN(a.getTime()))console.log("No se pudo determinar la fecha exacta, asumiendo journal antiguo"),s=e+1;else{var f=l-a;(s=Math.ceil(f/864e5))<0?console.log("Journal:",n.name,"Es del futuro (en",-s,"días)"):console.log("Journal:",n.name,"Edad en días:",s)}s>=e?o(n,(function(o){o?(console.log("Eliminando journal vacío:",n.name),logseq.Editor.deletePage(n.name).then((function(){r++,c++,g()})).catch((function(o){console.error("Error al eliminar página:",o),c++,g()}))):(console.log("Journal no está vacío:",n.name),c++,g())})):(console.log("Journal no es lo suficientemente antiguo:",n.name),c++,g())}catch(o){console.error("Error procesando journal:",o),c++,g()}}))}else logseq.UI.showMsg("No se encontraron journals","info");function g(){if(c>=s)if(r>0){var o="Se han eliminado "+r+" journals vacíos";t>0&&(o+=" (se excluyó el journal del día actual)"),logseq.UI.showMsg(o,"success")}else o="No se encontraron journals vacíos para eliminar",t>0&&(o+=" (se excluyó el journal del día actual)"),logseq.UI.showMsg(o,"info")}})).catch((function(o){console.error("Error al obtener journals:",o),logseq.UI.showMsg("Error al procesar journals","error")}))};logseq.Editor.registerSlashCommand("Eliminar todos los journals vacíos",(function(){e(-99999)})),logseq.Editor.registerSlashCommand("Eliminar journals vacíos (antiguos)",(function(){e(0)})),logseq.Editor.registerSlashCommand("Eliminar journals vacíos (solo del pasado)",(function(){e(1)})),logseq.Editor.registerSlashCommand("Verificar journals vacíos",(function(){logseq.UI.showMsg("Verificando journals vacíos...","info"),logseq.DB.datascriptQuery("\n      [:find (pull ?p [*])\n       :where\n       [?p :block/journal? true]]\n    ").then((function(e){if(e&&0!==e.length){var a=0,l=0,r=[],s=[],c=0;if(e.forEach((function(o){var e=o[0];e&&e.name&&(n(e)?(console.log("Saltando journal del día actual:",e.name),c++):(s.push(e),a++))})),console.log("Total de journals válidos para verificar:",a),0===a){var i="No se encontraron journals válidos para verificar";return c>0&&(i+=" (se excluyó el journal del día actual)"),void logseq.UI.showMsg(i,"info")}s.forEach((function(n){o(n,(function(o){if(o?(console.log("Journal VACÍO:",n.name),r.push(n.name)):console.log("Journal con contenido:",n.name),++l>=a)if(r.length>0){console.log("Journals vacíos encontrados:",r.length),console.log("Lista de journals vacíos:",r);var e="Se encontraron "+r.length+" journals vacíos. Lista en consola.";c>0&&(e+=" (se excluyó el journal del día actual)"),logseq.UI.showMsg(e,"info")}else e="No se encontraron journals vacíos",c>0&&(e+=" (se excluyó el journal del día actual)"),logseq.UI.showMsg(e,"info")}))}))}else logseq.UI.showMsg("No se encontraron journals","info")})).catch((function(o){console.error("Error al obtener journals:",o),logseq.UI.showMsg("Error al verificar journals","error")}))})),logseq.Editor.registerSlashCommand("Listar journals",(function(){logseq.DB.datascriptQuery("\n      [:find (pull ?p [*])\n       :where\n       [?p :block/journal? true]]\n    ").then((function(o){if(o&&0!==o.length){var n=0;console.log("Lista de todos los journals:"),o.forEach((function(o){var e=o[0];e&&e.name&&(console.log("Journal:",e.name),console.log("Propiedades:",e),n++)})),logseq.UI.showMsg("Se han listado "+n+" journals válidos en la consola","info")}else logseq.UI.showMsg("No se encontraron journals","info")})).catch((function(o){console.error("Error al obtener journals:",o),logseq.UI.showMsg("Error al listar journals","error")}))}))}));